<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
            integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
            integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
            crossorigin="anonymous">
    </script>
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col">
            <form id="elecomp-product-form">
                <div class="form-group">
                    <label for="exampleInputEmail1" class="float-right">متن خود را وارد کنید:</label>
                    <textarea class="form-control" id="exampleInputEmail1">
                    </textarea>
                </div>
                <button type="submit" class="btn btn-primary">Submit</button>
            </form>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <div id="slider-pos-1"></div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        function htmlToElement(html) {
            var template = document.createElement('div');
            template.innerHTML = html;
            return template.firstChild;
        }

        $("#elecomp-product-form").submit(function (e) {
            e.preventDefault();
            var token = '3e8f6b493dc6c70f66851adf93388edbefa13a4d';
            $.post({
                url: 'https://cg-admin.yektanet.com/api/v2/doc2product/',
                headers: { "Authorization": 'Token ' + token },
                data : {
                    content: "سلام"
                },
            }).done(function (resp) {
                debugger;
                for (var i = 0; i < resp.length; i++) {
                    let extData = resp[i].data;
                    var ybn_template;
                    var yn_pos = $("#slider-pos-" + i)[0];
                    yn_pos.style.height = "auto";
                    yn_pos.style.width = "100%";
                    yn_pos.style.maxHeight = extData.height + "px";
                    yn_pos.style.maxWidth = "100%";
                    yn_pos.style.overflow = "hidden";
                    yn_pos.style.textAlign = "center";
                    yn_pos.style.display = "table";
                    yn_pos.style.overflow = "visible";
                    yn_pos.style.width = extData.width;
                    yn_pos.style.margin = "0 auto 10px";
                    if (extData.advertiser_id && extData.sku) {
                        ybn_template = `<iframe id="iframe-${yn_pos.id}" style="max-width: 100%;max-height: 100%;display: none;margin: 7px auto;border: none;" src="https://cdn.yektanet.com/assets/templates/iframe/elecomp_product_slider.html" width="300px" height="250px" MARGINWIDTH=0 MARGINHEIGHT=0 FRAMEBORDER=0 SCROLLING="no"></iframe>`;
                    }
                    var all_css_parts = ".yn-bnr__branding img {height: 100%!important;}.yn-bnr__text{display:none!important;width: auto!important;height: 100%;vertical-align: middle;position: absolute;right: 0;top: 0;margin: 0!important;padding: 1px!important;} .yn-bnr__logo{width: auto!important;height: 100%!important;vertical-align: middle;position: absolute;right: 0;top: 0;margin: 0!important;padding: 1px!important;border: none!important;box-shadow: none!important;} .yn-bnr__branding{margin:0;box-sizing: border-box;height: 20px;width: 20px;background-color: #fff;position: absolute;right: 0;top: 0;border: 1px solid #ddd;overflow: hidden;} .yn-bnr__branding:hover .yn-bnr__logo{display:none!important;} .yn-bnr__branding:hover .yn-bnr__text{display:block!important;} .yn-bnr__branding:hover{width:54px;!important}";
                    var exist_style = document.querySelector(`.yn-bnr-style`);
                    if (!exist_style) {
                        var head = document.head || document.getElementsByTagName('head')[0];
                        var style = document.createElement('style');
                        style.className = "yn-bnr-style";
                        style.type = 'text/css';
                        style.styleSheet ? style.styleSheet.cssText = all_css_parts : style.appendChild(document.createTextNode(all_css_parts));
                        head.appendChild(style);
                    }
                    var newDiv = htmlToElement(ybn_template);
                    yn_pos.appendChild(newDiv);

                    yn_pos.firstElementChild.style.display = "table";
                    yn_pos.firstElementChild.style.margin = "0 auto";

                    var yn_iframe = document.querySelector('#iframe-' + i);
                    yn_iframe.onload = function () {
                        yn_iframe.contentWindow.postMessage({
                            product_data: resp[i].data,
                        }, '*');
                        yn_iframe.style.display = "block";
                    }
                }
            }).fail(function (resp) {
                debugger;

            })
        })
    });
</script>
</body>
</html>